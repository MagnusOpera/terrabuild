import "_protocol.fss"
import "_helpers.fss"

/// <summary>Runs Playwright end-to-end tests via `npx playwright`.</summary>
/// <summary>Executes `playwright test` with optional browser/project selection.</summary>
/// <param name="browser" required="false" example="&quot;webkit&quot;">Browser to use.</param>
/// <param name="project" required="false" example="&quot;ci&quot;">Project to use.</param>
/// <param name="args" required="false" example="&quot;--debug&quot;">Additional arguments passed to `playwright test`.</param>
[<export>] let test (context: ActionContext) (browser: string option) (project: string option) (args: string option) =
  let browser = _helpers.with_flag "--browser" browser
  let project = _helpers.with_flag "--project" project
  let args = args |> Option.defaultValue ""

  let command =
    ""
    |> _helpers.append_part "playwright test"
    |> _helpers.append_part browser
    |> _helpers.append_part project
    |> _helpers.append_part args

  [{ Command = "npx"; Arguments = command; ErrorLevel = 0 }]

// Exported functions and Terrabuild execution flags.
{
  [nameof test] = [Remote]
}
